<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="order"> 
<select id="selectPurchaseList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		select c.cart_num, (select p.prod_name from product p where p.prod_num = c.prod_num) prod_name, 
(select p.prod_price from product p where p.prod_num = c.prod_num) prod_price, 
(select nvl(p.prod_stock,0) from product p where p.prod_num = c.prod_num) prod_stock, c.prod_count, c.cart_del
from cart c where c.member_id = 'member01' and c.cart_rental = 0
	]]>
</select>

<select id="selectRentalList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		select c.cart_num, (select p.prod_name from product p where p.prod_num = c.prod_num) prod_name,
(select p.prod_rprice from product p where p.prod_num = c.prod_num) prod_rprice, 
(select p.prod_rstock from product p where p.prod_num = c.prod_num) real_stock,
(select count(DISTINCT prod_serial_num)
                                    from rental
                                    where prod_num = c.prod_num and rental_day between '2021-06-26' and '2021-07-4'
                                    group by prod_num) day_stock,
c.prod_count, c.cart_del
from cart c
where c.member_id = 'member01' and c.cart_rental = 1
	]]>
</select>

<delete id="deleteCartProduct" parameterType="hashmap">
	<![CDATA[
		delete from cart where cart_num = #{CART_NUM}
	]]>
</delete>

<update id="updateProdCount" parameterType="hashmap">
	<![CDATA[
		update cart set prod_count = #{PROD_COUNT} where cart_num = #{CART_NUM}
	]]>
</update>

<update id="updateCartDel" parameterType="hashmap">
	<![CDATA[
		update cart set cart_del = #{CART_DEL} where cart_num = #{CART_NUM}
	]]>
</update>

<select id="selectMemberInform" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		select * from member where member_id = 'member01'
	]]>
</select>

<insert id="insertBorder" parameterType="hashmap">
	<![CDATA[
		INSERT INTO BORDER VALUES(SEQ_ORDER_NUM.NEXTVAL,'member01',#{ORDER_RCV_NAME, jdbcType=VARCHAR},#{ORDER_RCV_PHONE },
		#{ORDER_RCV_ADDRESS1 },#{ORDER_RCV_ADDRESS2 },#{ORDER_RCV_ZONCODE },#{ORDER_MEMO, jdbcType=VARCHAR },
		#{ORDER_DPRICE },#{ORDER_PRICE },#{ORDER_PAYTYPE },default)
	]]>
</insert>

<select id="selectLastOrderNum" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT order_num
		FROM(SELECT order_num FROM border ORDER BY ROWNUM DESC)
		WHERE ROWNUM = 1
	]]>
</select>

<insert id="insertDorder" parameterType="hashmap">
	<![CDATA[
		INSERT INTO DORDER VALUES(SEQ_DORDER_NUM.NEXTVAL,#{ORDER_NUM},#{PROD_NUM},#{PROD_COUNT},
		#{RENTAL_START},#{RENTAL_END},#{ORDER_STATUS},null,null, default)
	]]>
</insert>

<insert id="insertDorderWithNull" parameterType="hashmap">
	<![CDATA[
		INSERT INTO DORDER VALUES(SEQ_DORDER_NUM.NEXTVAL,#{ORDER_NUM},#{PROD_NUM},#{PROD_COUNT},
		null,null,#{ORDER_STATUS},null,null, default)
	]]>
</insert>

<select id="selectCartWithoutDel" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		select * from cart where member_id=#{MEMBER_ID} and cart_del=0
	]]>
</select>

</mapper>